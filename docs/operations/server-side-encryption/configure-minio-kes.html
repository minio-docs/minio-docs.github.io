

<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<meta content="Deploy MinIO with Server-Side Object Encryption" name="description" />
<meta content="encryption, security, hashicorp, keyvault, azure" name="keywords" />

    <title>Server-Side Object Encryption with KES &#8212; MinIO Object Storage (AGPLv3)</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/main.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script src="../../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js"></script>
    <script src="../../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/instantsearch.js@4"></script>
    <script defer="defer" src="../../_static/js/main.js"></script>
    <script defer="defer" src="../../_static/js/instantSearch.js"></script>
    <link rel="canonical" href="https://docs.min.io/community/minio-object-store/operations/server-side-encryption/configure-minio-kes.html" />
    <link rel="icon" href="../../_static/favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Network Encryption (TLS)" href="../network-encryption.html" />
    <link rel="prev" title="Data Encryption (SSE)" href="../server-side-encryption.html" /><meta name="pagename" content="operations/server-side-encryption/configure-minio-kes"/>

<!-- Preload fonts and scripts -->
<link rel="preload" href="../../_static/fonts/inter/Inter-Regular.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="../../_static/fonts/inter/Inter-Medium.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="../../_static/fonts/inter/Inter-Bold.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preconnect" href="https://E1CSOK3UC2-dsn.algolia.net" crossorigin />

<!-- Google Tag Manager: docs.min.io -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-56L9FLVL');</script>

<!-- Google Tag Manager: main -->
<script>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TWQNHTD');
</script>

<!-- Google Analytics -->
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-56860620-1', 'auto');
    ga('send', 'pageview');
</script>

<!-- Linkedin -->
<script>
    _linkedin_partner_id = "1153348";
    window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
    window._linkedin_data_partner_ids.push(_linkedin_partner_id);

    (function(l) {
    if (!l){window.lintrk = function(a,b){window.lintrk.q.push([a,b])};
    window.lintrk.q=[]}
    var s = document.getElementsByTagName("script")[0];
    var b = document.createElement("script");
    b.type = "text/javascript";b.async = true;
    b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
    s.parentNode.insertBefore(b, s);})(window.lintrk);
</script>

<!-- Leadfeeder -->
<script>
    (function(){
        window.ldfdr = window.ldfdr || {};
        (function(d, s, ss, fs){
        fs = d.getElementsByTagName(s)[0];
        function ce(src){
            var cs  = d.createElement(s);
            cs.src = src;
            setTimeout(function(){fs.parentNode.insertBefore(cs,fs)}, 1);
        }
        ce(ss);
        })(document, 'script', 'https://sc.lfeeder.com/lftracker_v1_DzLR5a5kKJA7BoQ2.js');
    })();
</script>
   
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  


  </head><body><!-- Google Tag Manager: docs.min.io (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-56L9FLVL" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) --><header class="header inactive">
   <div class="container">
      <div class="header__inner">
         <a href="https://min.io?jmp=docs-minio-object-store" class="header__logo">
            <svg viewBox="0 0 162.612 24.465">
               <path d="M52.751.414h9.108v23.63h-9.108zM41.711.74l-18.488 9.92a.919.919 0 0 1-.856 0L3.879.74A2.808 2.808 0 0 0 2.558.414h-.023A2.4 2.4 0 0 0 0 2.641v21.376h9.1V13.842a.918.918 0 0 1 1.385-.682l10.361 5.568a3.634 3.634 0 0 0 3.336.028l10.933-5.634a.917.917 0 0 1 1.371.69v10.205h9.1V2.641A2.4 2.4 0 0 0 43.055.414h-.023a2.808 2.808 0 0 0-1.321.326zm65.564-.326h-9.237v10.755a.913.913 0 0 1-1.338.706L72.762.675a2.824 2.824 0 0 0-1.191-.261h-.016a2.4 2.4 0 0 0-2.535 2.227v21.377h9.163V13.275a.914.914 0 0 1 1.337-.707l24.032 11.2a2.813 2.813 0 0 0 1.188.26 2.4 2.4 0 0 0 2.535-2.227zm7.161 23.63V.414h4.191v23.63zm28.856.421c-11.274 0-19.272-4.7-19.272-12.232C124.02 4.741 132.066 0 143.292 0s19.32 4.7 19.32 12.233-7.902 12.232-19.32 12.232zm0-21.333c-8.383 0-14.84 3.217-14.84 9.1 0 5.926 6.457 9.1 14.84 9.1s14.887-3.174 14.887-9.1c0-5.883-6.504-9.1-14.887-9.1z" />
            </svg>
         </a>
         
         <!--
         <div class="header__actions">
            

            <button id="dark-mode-toggle" type="button" class="icon icon--switch"><svg width="21" height="21" viewBox="0 0 48 48" fill="currentColor">
    <path d="M24 42q-7.5 0-12.75-5.25T6 24q0-6.75 3.975-11.45Q13.95 7.85 20.4 6.5q2.05-.4 2.8.7t-.05 3q-.45 1.15-.7 2.35-.25 1.2-.25 2.45 0 4.5 3.15 7.65Q28.5 25.8 33 25.8q1.25 0 2.425-.225 1.175-.225 2.275-.625 2.15-.8 3.2.075 1.05.875.55 2.975-1.35 6.05-6.05 10.025Q30.7 42 24 42Zm0-3q5.45 0 9.5-3.375t5.05-7.925q-1.25.55-2.675.825Q34.45 28.8 33 28.8q-5.75 0-9.775-4.025T19.2 15q0-1.2.25-2.575.25-1.375.9-3.125-4.9 1.35-8.125 5.475Q9 18.9 9 24q0 6.25 4.375 10.625T24 39Zm-.2-14.85Z" />
</svg><svg width="17" height="17" viewBox="0 0 17 17">
    <path d="M8.5 2.898c-.167 0-.306-.055-.415-.164s-.164-.248-.164-.415V.58c0-.167.055-.306.164-.415S8.333 0 8.5 0s.306.055.415.164.164.248.164.415v1.739c0 .167-.055.306-.164.415s-.248.164-.415.164zm3.96 1.642c-.116-.116-.174-.251-.174-.406s.058-.29.174-.406l1.217-1.236c.116-.116.254-.174.415-.174s.299.058.415.174.174.251.174.406-.058.29-.174.406L13.272 4.54c-.116.116-.251.174-.406.174s-.29-.058-.406-.174zm2.222 4.54c-.167 0-.306-.055-.415-.164s-.164-.248-.164-.415.055-.306.164-.415.248-.164.415-.164h1.739c.167 0 .306.055.415.164S17 8.333 17 8.5s-.055.306-.164.415-.248.164-.415.164h-1.739zM8.5 17c-.167 0-.306-.055-.415-.164s-.164-.248-.164-.415v-1.739c0-.167.055-.306.164-.415s.248-.164.415-.164.306.055.415.164.164.248.164.415v1.739c0 .167-.055.306-.164.415S8.667 17 8.5 17zM3.728 4.54L2.492 3.323c-.116-.116-.174-.254-.174-.415s.058-.299.174-.415.251-.174.406-.174.29.058.406.174L4.54 3.728c.116.116.174.251.174.406s-.058.29-.174.406c-.116.103-.254.155-.415.155s-.293-.052-.396-.155zm9.968 9.968l-1.236-1.236c-.116-.116-.174-.251-.174-.406s.058-.29.174-.406c.103-.103.235-.155.396-.155s.299.052.415.155l1.256 1.217c.116.116.171.254.164.415s-.061.299-.164.415c-.116.116-.254.174-.415.174s-.299-.058-.415-.174h0zM.58 9.08c-.167 0-.306-.055-.415-.164S0 8.667 0 8.5s.055-.306.164-.415.248-.164.415-.164h1.739c.167 0 .306.055.415.164s.164.248.164.415-.055.306-.164.415-.248.164-.415.164H.58zm1.912 5.428c-.116-.116-.174-.251-.174-.406s.058-.29.174-.406l1.236-1.236c.103-.103.235-.155.396-.155s.299.052.415.155c.116.116.174.254.174.415s-.058.299-.174.415l-1.217 1.217c-.116.116-.254.174-.415.174s-.299-.058-.415-.174h0zM8.5 13.136a4.47 4.47 0 0 1-3.284-1.352A4.47 4.47 0 0 1 3.864 8.5a4.47 4.47 0 0 1 1.352-3.284A4.47 4.47 0 0 1 8.5 3.864a4.47 4.47 0 0 1 3.284 1.352A4.47 4.47 0 0 1 13.136 8.5a4.47 4.47 0 0 1-1.352 3.284A4.47 4.47 0 0 1 8.5 13.136zm0-1.159a3.35 3.35 0 0 0 2.463-1.014A3.35 3.35 0 0 0 11.977 8.5a3.35 3.35 0 0 0-1.014-2.463A3.35 3.35 0 0 0 8.5 5.023a3.35 3.35 0 0 0-2.463 1.014A3.35 3.35 0 0 0 5.023 8.5a3.35 3.35 0 0 0 1.014 2.463A3.35 3.35 0 0 0 8.5 11.977z" fill="currentColor" />
</svg>
               Dark Mode
            </button>
         </div>
         -->
      </div>
  
      <h2 class="header__title hidden-rm">Documentation</h2>

      

      <!--<div class="platform-nav">
    <div class="platform-nav__main">
        <div class="container">
        </div>
        <button type="button" class="icon search-toggle search-toggle--keyboard visible-rm"><svg width="14" height="15">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M11.5 6.5a5 5 0 1 1-10 0 5 5 0 0 1 10 0Zm-1.59 5.535a6.5 6.5 0 1 1 1.179-.931l1.845 2.096a.75.75 0 0 1-1.127.99L9.91 12.036Z"/>
</svg>
            Search
        </button>
    </div>
</div> -->
         <div id="search">
            <div class="search__inner">
               <div id="search-box"></div>
               
               <div class="search__dropdown">
                  <div id="search-filters"></div>
                  <div id="search-clear"></div>
                  <div id="search-results"></div>
                  <div id="search-powered-by"></div>
               </div>
            </div>
         </div>
   </div>
 </header>
   <section class="content">
      <div class="container">
         <div class="sidebar inactive scrollbar">
            <div class="hide-aside visible-rm">
               <button type="button" class="icon"><svg width="12" height="12">
    <path d="M11.253 1.691L10.125.563 5.653 5.035 1.181.563.053 1.691l4.472 4.472-4.472 4.472 1.128 1.128 4.472-4.472 4.472 4.472 1.128-1.128-4.472-4.472z" fill-rule="evenodd"/>
</svg>
                     Close Doc Navigation
               </button>
            </div>

            <a class="sidebar__title" href="../../index.html">MinIO Object Storage</a>
            
            
      <nav
         class="docs"
         role="navigation"
      >
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../deployments/installation.html">Installation and Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../replication/multi-site-replication.html">Site Replication Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Core Operational Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitoring.html">Monitoring and Alerts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../external-iam.html">External Identity Management</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../server-side-encryption.html">Data Encryption (SSE)</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Server-Side Object Encryption with KES</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../network-encryption.html">Network Encryption (TLS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../checklists.html">Deployment Checklists</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data-recovery.html">Recover after Hardware Failure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/minio-console.html">MinIO Console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/object-management.html">Object Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/monitoring.html">Monitoring Bucket and Object Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/identity-access-management.html">Identity and Access Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/server-side-encryption.html">Server-Side Encryption of Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/bucket-replication.html">Bucket Replication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/batch-framework.html">Batch Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../administration/concepts.html">Core Administration Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers/minio-drivers.html">Software Development Kits (SDK)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers/security-token-service.html">Security Token Service (STS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers/transforms-with-object-lambda.html">Transforms with Object Lambda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers/file-transfer-protocol.html">File Transfer Protocol (FTP/SFTP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/kubernetes.html">Kubernetes Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/baremetal.html">Baremetal Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/s3-api-compatibility.html">S3 API Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations/integrations.html">Integrations</a></li>
</ul>

      </nav>
         </div><div class="content__toc scrollbar scrollbar--hover">
  	<button data-aside-toggle="doc" class="icon" type="button"><svg width="17" height="13" viewbox="0 0 17 13">
    <path d="M16.034 0H.966C.433 0 0 .346 0 .773s.433.773.966.773h15.068c.533 0 .966-.346.966-.773S16.567 0 16.034 0zm0 5.409H.966c-.533 0-.966.346-.966.773s.433.773.966.773h15.068c.533 0 .966-.346.966-.773s-.433-.773-.966-.773zm0 5.409H.966c-.533 0-.966.346-.966.773s.433.773.966.773h15.068c.533 0 .966-.346.966-.773s-.433-.773-.966-.773z" />
</svg> TOC Menu
  	</button>

  	<div id="content-toc"></div>
		<button class="icon search-toggle" type="button"><svg width="14" height="15">
    <path fill-rule="evenodd" clip-rule="evenodd" d="M11.5 6.5a5 5 0 1 1-10 0 5 5 0 0 1 10 0Zm-1.59 5.535a6.5 6.5 0 1 1 1.179-.931l1.845 2.096a.75.75 0 0 1-1.127.99L9.91 12.036Z"/>
</svg> Search
		</button>
</div>

         <div class="content__main">
            <div class="content__body">
               
  <section id="server-side-object-encryption-with-kes">
<span id="minio-sse-aws"></span><span id="minio-sse-azure"></span><span id="minio-sse-gcp"></span><span id="minio-sse-vault"></span><h1>Server-Side Object Encryption with KES<a class="headerlink" href="#server-side-object-encryption-with-kes" title="Permalink to this heading"></a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#prerequisites" id="id1">Prerequisites</a></p></li>
<li><p><a class="reference internal" href="#procedure" id="id2">Procedure</a></p></li>
</ul>
</nav>
<div class="sd-tab-set parent docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" data-sync-id="k8s" for="sd-tab-item-0">
Kubernetes</label><div class="sd-tab-content docutils">
<p>This procedure assumes you have access to a Kubernetes cluster with an active MinIO Operator installation.
For instructions on running KES, see the <a class="reference external" href="https://docs.min.io/community/minio-kes/tutorials/getting-started/">KES docs</a>.</p>
<p>As part of this procedure, you will:</p>
<ol class="arabic simple">
<li><p>Create or modify a MinIO deployment with support for <abbr title="Server-Side Encryption">SSE</abbr> using <abbr title="Key Encryption Service">KES</abbr>.
Defer to the <a class="reference internal" href="../deployments/installation.html#minio-mnmd"><span class="std std-ref">Deploy Distributed MinIO</span></a> tutorial for guidance on production-ready MinIO deployments.</p></li>
<li><p>Use the MinIO Operator Console to create or manage a MinIO Tenant.</p></li>
<li><p>Access the <span class="guilabel">Encryption</span> settings for that tenant and configure <abbr title="Server-Side Encryption">SSE</abbr> using a <a class="reference external" href="https://docs.min.io/community/minio-kes/#supported-kms-targets">supported Key Management System</a>.</p></li>
<li><p>Create a new <abbr title="External Key">EK</abbr> for use with <abbr title="Server-Side Encryption">SSE</abbr>.</p></li>
<li><p>Configure automatic bucket-default <a class="reference internal" href="../../administration/server-side-encryption/server-side-encryption-sse-kms.html#minio-encryption-sse-kms"><span class="std std-ref">SSE-KMS</span></a>.</p></li>
</ol>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" data-sync-id="baremetal" for="sd-tab-item-1">
Baremetal</label><div class="sd-tab-content docutils">
<p>This procedure provides guidance for deploying MinIO configured to use KES and enable <a class="reference internal" href="../server-side-encryption.html#minio-sse-data-encryption"><span class="std std-ref">Server Side Encryption</span></a>.
For instructions on running KES, see the <a class="reference external" href="https://docs.min.io/community/minio-kes/tutorials/getting-started/">KES docs</a>.</p>
<p>As part of this procedure, you will:</p>
<ol class="arabic simple">
<li><p>Create a new <abbr title="External Key">EK</abbr> for use with <abbr title="Server-Side Encryption">SSE</abbr>.</p></li>
<li><p>Create or modify a MinIO deployment with support for <abbr title="Server-Side Encryption">SSE</abbr> using <abbr title="Key Encryption Service">KES</abbr>.
Defer to the <a class="reference internal" href="../deployments/installation.html#minio-mnmd"><span class="std std-ref">Deploy Distributed MinIO</span></a> tutorial for guidance on production-ready MinIO deployments.</p></li>
<li><p>Configure automatic bucket-default <a class="reference internal" href="../../administration/server-side-encryption/server-side-encryption-sse-kms.html#minio-encryption-sse-kms"><span class="std std-ref">SSE-KMS</span></a></p></li>
</ol>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Enabling <abbr title="Server-Side Encryption">SSE</abbr> on a MinIO deployment automatically encrypts the backend data for that deployment using the default encryption key.</p>
<p>MinIO <em>requires</em> access to KES and the external KMS to decrypt the backend and start normally.
The KMS <strong>must</strong> maintain and provide access to the <a class="reference internal" href="../../reference/minio-server/settings/kes.html#envvar.MINIO_KMS_KES_KEY_NAME" title="envvar.MINIO_KMS_KES_KEY_NAME"><code class="xref minio minio-envvar docutils literal notranslate"><span class="pre">MINIO_KMS_KES_KEY_NAME</span></code></a>.
You cannot disable KES later or “undo” the <abbr title="Server-Side Encryption">SSE</abbr> configuration at a later point.</p>
</div>
<section id="prerequisites">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this heading"></a></h2>
<section id="access-to-minio-cluster">
<h3>Access to MinIO Cluster<a class="headerlink" href="#access-to-minio-cluster" title="Permalink to this heading"></a></h3>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" data-sync-id="k8s" for="sd-tab-item-2">
Kubernetes</label><div class="sd-tab-content docutils">
<p>You must have access to the Kubernetes cluster, with administrative permissions associated to your <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> configuration.</p>
<p>This procedure assumes your permission sets extends sufficiently to support deployment or modification of MinIO-associated resources on the Kubernetes cluster, including but not limited to pods, statefulsets, replicasets, deployments, and secrets.</p>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" data-sync-id="baremetal" for="sd-tab-item-3">
Baremetal</label><div class="sd-tab-content docutils">
<p>This procedure uses <a class="reference internal" href="../../reference/minio-mc.html#command-mc" title="mc"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">mc</span></code></a> for performing operations on the MinIO cluster.
Install <code class="docutils literal notranslate"><span class="pre">mc</span></code> on a machine with network access to the cluster.
See the <code class="docutils literal notranslate"><span class="pre">mc</span></code> <a class="reference internal" href="../../reference/minio-mc.html#mc-install"><span class="std std-ref">Installation Quickstart</span></a> for instructions on downloading and installing <code class="docutils literal notranslate"><span class="pre">mc</span></code>.</p>
<p>This procedure assumes a configured <a class="reference internal" href="../../reference/minio-mc/mc-alias.html#command-mc.alias" title="mc.alias"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">alias</span></code></a> for the MinIO cluster.</p>
</div>
</div>
</section>
<section id="ensure-kes-access-to-a-supported-kms-target">
<span id="minio-sse-vault-prereq-vault"></span><h3>Ensure KES Access to a Supported KMS Target<a class="headerlink" href="#ensure-kes-access-to-a-supported-kms-target" title="Permalink to this heading"></a></h3>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-4" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" data-sync-id="k8s" for="sd-tab-item-4">
Kubernetes</label><div class="sd-tab-content docutils">
<p>This procedure assumes an existing <a class="reference external" href="https://docs.min.io/community/minio-kes/#supported-kms-targets">supported KMS installation</a> accessible from the Kubernetes cluster.</p>
<ul class="simple">
<li><p>For deployments within the same Kubernetes cluster as the MinIO Tenant, you can use Kubernetes service names to allow the MinIO Tenant to establish connectivity to the target KMS service.</p></li>
<li><p>For deployments external to the Kubernetes cluster, you must ensure the cluster supports routing communications between Kubernetes services and pods and the external network.
This may require configuration or deployment of additional Kubernetes network components and/or enabling access to the public internet.</p></li>
</ul>
<p>Defer to the documentation for your chosen KMS solution for guidance on deployment and configuration.</p>
</div>
<input id="sd-tab-item-5" name="sd-tab-set-2" type="radio">
</input><label class="sd-tab-label" data-sync-id="baremetal" for="sd-tab-item-5">
Baremetal</label><div class="sd-tab-content docutils">
<p>This procedure assumes an existing KES installation connected to a supported <abbr title="Key Management System">KMS</abbr> installation accessible, both accessible from the local host.
Refer to the installation instructions for your <a class="reference external" href="https://docs.min.io/community/minio-kes/#supported-kms-targets">supported KMS target</a> to deploy KES and connect it to a KMS solution.</p>
</div>
</div>
<div class="important admonition">
<p class="admonition-title">KES Operations Require Unsealed Target</p>
<p>Some supported <abbr title="Key Management System">KMS</abbr> targets allow you to seal or unseal the vault instance.
KES returns an error if the configured <abbr title="Key Management System">KMS</abbr> service is sealed.</p>
<p>If you restart or otherwise seal your vault instance, KES cannot perform any cryptographic operations against the vault.
You must unseal the Vault to ensure normal operations.</p>
<p>See the documentation for your chosen <abbr title="Key Management System">KMS</abbr> solution for more information on whether unsealing may be required.</p>
</div>
<p>Refer to the configuration instruction in the <a class="reference external" href="https://docs.min.io/community/minio-kes/">KES documentation</a> for your chosen supported <abbr title="Key Management System">KMS</abbr>:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.min.io/community/minio-kes/integrations/aws-secrets-manager/">AWS Secrets Manager</a></p></li>
<li><p><a class="reference external" href="https://docs.min.io/community/minio-kes/integrations/azure-keyvault/">Azure KeyVault</a></p></li>
<li><p><a class="reference external" href="https://docs.min.io/community/minio-kes/integrations/entrust-keycontrol/">Entrust KeyControl</a></p></li>
<li><p><a class="reference external" href="https://docs.min.io/community/minio-kes/integrations/fortanix-sdkms/">Fortanix SDKMS</a></p></li>
<li><p><a class="reference external" href="https://docs.min.io/community/minio-kes/integrations/google-cloud-secret-manager/">Google Cloud Secret Manager</a></p></li>
<li><p><a class="reference external" href="https://docs.min.io/community/minio-kes/integrations/hashicorp-vault-keystore/">HashiCorp Vault</a></p></li>
<li><p><a class="reference external" href="https://docs.min.io/community/minio-kes/integrations/thales-ciphertrust/">Thales CipherTrust Manager (formerly Gemalto KeySecure)</a></p></li>
</ul>
</section>
</section>
<section id="procedure">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Procedure</a><a class="headerlink" href="#procedure" title="Permalink to this heading"></a></h2>
<p>This procedure provides instructions for configuring and enabling Server-Side Encryption using your selected <a class="reference external" href="https://docs.min.io/community/minio-kes/#supported-kms-targets">supported KMS solution</a> in production environments.
Specifically, this procedure assumes the following:</p>
<ul class="simple">
<li><p>An existing production-grade KMS target</p></li>
<li><p>One or more KES servers connected to the KMS target</p></li>
<li><p>One or more hosts for a new or existing MinIO deployment</p></li>
</ul>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-6" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" data-sync-id="k8s" for="sd-tab-item-6">
Kubernetes</label><div class="sd-tab-content docutils">
<ol class="arabic">
<li><p>Review the Tenant CRD</p>
<p>Review the <a class="reference internal" href="../../reference/operator-crd.html#minio-operator-crd"><span class="std std-ref">Tenant CRD</span></a> <code class="docutils literal notranslate"><span class="pre">TenantSpec.kes</span></code> object, the <code class="docutils literal notranslate"><span class="pre">TenantSpec.configuration</span></code> object, and the <a class="reference external" href="https://docs.min.io/community/minio-object-store//kes/tutorials/configuration?ref=docs-internal">KES Configuration reference</a>.</p>
<p>You must prepare all necessary configurations associated to your external Key Management Service of choice before proceeding.</p>
</li>
<li><p>Create or Modify your Tenant YAML to set the values of <code class="docutils literal notranslate"><span class="pre">KesConfig</span></code> as necessary:</p>
<p>You must modify your Tenant YAML or <code class="docutils literal notranslate"><span class="pre">Kustomize</span></code> templates to reflect the necessary KES configuration.
The following example is taken from the <a class="reference external" href="https://github.com/minio//operator/blob/master/examples/kustomization/tenant-kes-encryption/tenant.yaml">MinIO Operator Kustomize examples</a></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">kes</span><span class="p">:</span>
<span class="w">   </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># minio/kes:2024-06-17T15-47-05Z</span>
<span class="w">   </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">   </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">   </span><span class="nt">kesSecret</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kes-configuration</span>
<span class="w">   </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;IfNotPresent&quot;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">kes-configuration</span></code> secret must reference a Kubernetes Opaque Secret which contains a <code class="docutils literal notranslate"><span class="pre">stringData</span></code> object with the full KES configuration as <code class="docutils literal notranslate"><span class="pre">server-config.yaml</span></code>.
The <code class="docutils literal notranslate"><span class="pre">keystore</span></code> field must contain the full configuration associated with your preferred Key Management System.</p>
<p>Reference <a class="reference external" href="https://github.com/minio/operator/blob/master/examples/kustomization/tenant-kes-encryption/kes-configuration-secret.yaml">the Kustomize example</a> for additional guidance.</p>
</li>
<li><p>Create or Modify your Tenant YAML to set the values of <code class="docutils literal notranslate"><span class="pre">TenantSpec.configuration</span></code> as necessary.</p>
<p>TODO</p>
</li>
<li><p>Generate a New Encryption Key</p>
<div class="important admonition">
<p class="admonition-title">Unseal Vault Before Creating Key</p>
<p>If required by your chosen provider, you must unseal the backing vault instance before creating new encryption keys.
See the documentation for your chosen KMS solution for more information.</p>
</div>
<p>MinIO requires that the <abbr title="External Key">EK</abbr> for a given bucket or object exist on the root KMS <em>before</em> performing <abbr title="Server-Side Encryption">SSE</abbr> operations using that key.
You can use the <a class="reference internal" href="../../reference/minio-mc-admin/mc-admin-kms-key.html#mc.admin.kms.key.create" title="mc.admin.kms.key.create"><code class="xref minio minio-mc-cmd docutils literal notranslate"><span class="pre">mc</span> <span class="pre">admin</span> <span class="pre">kms</span> <span class="pre">key</span> <span class="pre">create</span></code></a> command against the MinIO Tenant.</p>
<p>You must ensure your local host can access the MinIO Tenant pods and services before using <a class="reference internal" href="../../reference/minio-mc.html#command-mc" title="mc"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">mc</span></code></a> to manage the Tenant.
For hosts internal to the Kubernetes cluster, you can use the <a class="reference external" href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#a-aaaa-records">service DNS name</a>.
For hosts external to the Kubernetes cluster, specify the hostname of the service exposed by Ingress, Load Balancer, or similar Kubernetes network control component.</p>
<p>Run this command in a separate Terminal or Shell:</p>
<div class="copyable highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace &#39;-n minio&#39; with the namespace of the MinIO deployment</span>
<span class="c1"># If you deployed the Tenant without TLS you may need to change the port range</span>

<span class="c1"># You can validate the ports in use by running</span>
<span class="c1">#  kubectl get svc/minio -n minio</span>

kubectl<span class="w"> </span>port<span class="w"> </span>forward<span class="w"> </span>svc/minio<span class="w"> </span><span class="m">443</span>:443<span class="w"> </span>-n<span class="w"> </span>minio
</pre></div>
</div>
<p>The following commands in a new Terminal or Shell window:</p>
<ul class="simple">
<li><p>Connect a local <a class="reference internal" href="../../reference/minio-mc.html#command-mc" title="mc"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">mc</span></code></a> client to the Tenant.</p></li>
<li><p>Create the encryption key.</p></li>
</ul>
<p>See <a class="reference internal" href="../../reference/minio-mc.html#mc-install"><span class="std std-ref">Quickstart</span></a> for instructions on installing <code class="docutils literal notranslate"><span class="pre">mc</span></code> on your local host.</p>
<div class="copyable highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace USERNAME and PASSWORD with a user on the tenant with administrative permissions</span>
<span class="c1"># such as the root user</span>

mc<span class="w"> </span><span class="nb">alias</span><span class="w"> </span>add<span class="w"> </span>k8s<span class="w"> </span>https://localhost:443<span class="w"> </span>ROOTUSER<span class="w"> </span>ROOTPASSWORD

<span class="c1"># Replace my-new-key with the name of the key you want to use for SSE-KMS</span>
mc<span class="w"> </span>admin<span class="w"> </span>kms<span class="w"> </span>key<span class="w"> </span>create<span class="w"> </span>k8s<span class="w"> </span>encrypted-bucket-key
</pre></div>
</div>
</li>
<li><p>Enable SSE-KMS for a Bucket</p>
<p>You can use either the MinIO Tenant Console or the MinIO <a class="reference internal" href="../../reference/minio-mc.html#command-mc" title="mc"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">mc</span></code></a> CLI to enable bucket-default SSE-KMS with the generated key:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-8" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-8">
MinIO Tenant Console</label><div class="sd-tab-content docutils">
<p>Connect to the <a class="reference internal" href="../deployments/k8s-deploy-minio-tenant-on-kubernetes.html#create-tenant-connect-tenant"><span class="std std-ref">MinIO Tenant Console service</span></a> and log in.
For clients internal to the Kubernetes cluster, you can specify the <a class="reference external" href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#a-aaaa-records">service DNS name</a>.
For clients external to the Kubernetes cluster, specify the hostname of the service exposed by Ingress, Load Balancer, or similar Kubernetes network control component.</p>
<p>Once logged in, create a new Bucket and name it to your preference.
Select the Gear <svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-gear" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M7.429 1.525a6.593 6.593 0 011.142 0c.036.003.108.036.137.146l.289 1.105c.147.56.55.967.997 1.189.174.086.341.183.501.29.417.278.97.423 1.53.27l1.102-.303c.11-.03.175.016.195.046.219.31.41.641.573.989.014.031.022.11-.059.19l-.815.806c-.411.406-.562.957-.53 1.456a4.588 4.588 0 010 .582c-.032.499.119 1.05.53 1.456l.815.806c.08.08.073.159.059.19a6.494 6.494 0 01-.573.99c-.02.029-.086.074-.195.045l-1.103-.303c-.559-.153-1.112-.008-1.529.27-.16.107-.327.204-.5.29-.449.222-.851.628-.998 1.189l-.289 1.105c-.029.11-.101.143-.137.146a6.613 6.613 0 01-1.142 0c-.036-.003-.108-.037-.137-.146l-.289-1.105c-.147-.56-.55-.967-.997-1.189a4.502 4.502 0 01-.501-.29c-.417-.278-.97-.423-1.53-.27l-1.102.303c-.11.03-.175-.016-.195-.046a6.492 6.492 0 01-.573-.989c-.014-.031-.022-.11.059-.19l.815-.806c.411-.406.562-.957.53-1.456a4.587 4.587 0 010-.582c.032-.499-.119-1.05-.53-1.456l-.815-.806c-.08-.08-.073-.159-.059-.19a6.44 6.44 0 01.573-.99c.02-.029.086-.075.195-.045l1.103.303c.559.153 1.112.008 1.529-.27.16-.107.327-.204.5-.29.449-.222.851-.628.998-1.189l.289-1.105c.029-.11.101-.143.137-.146zM8 0c-.236 0-.47.01-.701.03-.743.065-1.29.615-1.458 1.261l-.29 1.106c-.017.066-.078.158-.211.224a5.994 5.994 0 00-.668.386c-.123.082-.233.09-.3.071L3.27 2.776c-.644-.177-1.392.02-1.82.63a7.977 7.977 0 00-.704 1.217c-.315.675-.111 1.422.363 1.891l.815.806c.05.048.098.147.088.294a6.084 6.084 0 000 .772c.01.147-.038.246-.088.294l-.815.806c-.474.469-.678 1.216-.363 1.891.2.428.436.835.704 1.218.428.609 1.176.806 1.82.63l1.103-.303c.066-.019.176-.011.299.071.213.143.436.272.668.386.133.066.194.158.212.224l.289 1.106c.169.646.715 1.196 1.458 1.26a8.094 8.094 0 001.402 0c.743-.064 1.29-.614 1.458-1.26l.29-1.106c.017-.066.078-.158.211-.224a5.98 5.98 0 00.668-.386c.123-.082.233-.09.3-.071l1.102.302c.644.177 1.392-.02 1.82-.63.268-.382.505-.789.704-1.217.315-.675.111-1.422-.364-1.891l-.814-.806c-.05-.048-.098-.147-.088-.294a6.1 6.1 0 000-.772c-.01-.147.039-.246.088-.294l.814-.806c.475-.469.679-1.216.364-1.891a7.992 7.992 0 00-.704-1.218c-.428-.609-1.176-.806-1.82-.63l-1.103.303c-.066.019-.176.011-.299-.071a5.991 5.991 0 00-.668-.386c-.133-.066-.194-.158-.212-.224L10.16 1.29C9.99.645 9.444.095 8.701.031A8.094 8.094 0 008 0zm1.5 8a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM11 8a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> icon to open the management view.</p>
<p>Select the pencil <svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-pencil" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25a1.75 1.75 0 01.445-.758l8.61-8.61zm1.414 1.06a.25.25 0 00-.354 0L10.811 3.75l1.439 1.44 1.263-1.263a.25.25 0 000-.354l-1.086-1.086zM11.189 6.25L9.75 4.81l-6.286 6.287a.25.25 0 00-.064.108l-.558 1.953 1.953-.558a.249.249 0 00.108-.064l6.286-6.286z"></path></svg> icon next to the <span class="guilabel">Encryption</span> field to open the modal for configuring a bucket default SSE scheme.</p>
<p>Select <span class="guilabel">SSE-KMS</span>, then enter the name of the key created in the previous step.</p>
<p>Once you save your changes, try to upload a file to the bucket.
When viewing that file in the object browser, note that in the sidebar the metadata includes the SSE encryption scheme and information on the key used to encrypt that object.
This indicates the successful encrypted state of the object.</p>
</div>
<input id="sd-tab-item-9" name="sd-tab-set-4" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-9">
MinIO CLI</label><div class="sd-tab-content docutils">
<p>Use the <a class="reference internal" href="../deployments/k8s-deploy-minio-tenant-on-kubernetes.html#create-tenant-connect-tenant"><span class="std std-ref">MinIO API Service</span></a> to create a new <a class="reference internal" href="../../reference/minio-mc/mc-alias-set.html#alias"><span class="std std-ref">alias</span></a> for the MinIO deployment.
You can then use the <a class="reference internal" href="../../reference/minio-mc/mc-encrypt-set.html#command-mc.encrypt.set" title="mc.encrypt.set"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">mc</span> <span class="pre">encrypt</span> <span class="pre">set</span></code></a> command to enable SSE-KMS encryption for a bucket:</p>
<div class="copyable highlight-shell notranslate"><div class="highlight"><pre><span></span>mc<span class="w"> </span><span class="nb">alias</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span>k8s<span class="w"> </span>https://minio.minio-tenant-1.svc.cluster-domain.example:443<span class="w"> </span>ROOTUSER<span class="w"> </span>ROOTPASSWORD

mc<span class="w"> </span>mb<span class="w"> </span>k8s/encryptedbucket
mc<span class="w"> </span>encrypt<span class="w"> </span><span class="nb">set</span><span class="w"> </span>SSE-KMS<span class="w"> </span>encrypted-bucket-key<span class="w"> </span>k8s/encryptedbucket
</pre></div>
</div>
<p>For clients external to the Kubernetes cluster, specify the hostname of the service exposed by Ingress, Load Balancer, or similar Kubernetes network control component.</p>
<p>Write a file to the bucket using <a class="reference internal" href="../../reference/minio-mc/mc-cp.html#command-mc.cp" title="mc.cp"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">mc</span> <span class="pre">cp</span></code></a> or any S3-compatible SDK with a <code class="docutils literal notranslate"><span class="pre">PutObject</span></code> function.
You can then run <a class="reference internal" href="../../reference/minio-mc/mc-stat.html#command-mc.stat" title="mc.stat"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">mc</span> <span class="pre">stat</span></code></a> on the file to confirm the associated encryption metadata.</p>
</div>
</div>
</li>
</ol>
</div>
<input id="sd-tab-item-7" name="sd-tab-set-3" type="radio">
</input><label class="sd-tab-label" data-sync-id="baremetal" for="sd-tab-item-7">
Baremetal</label><div class="sd-tab-content docutils">
<ol class="arabic">
<li><p>Generate a KES API Key for use by MinIO</p>
<p>Use the <a class="reference external" href="https://docs.min.io/community/minio-kes/cli/kes-identity/new">kes identity new</a> command to generate a new API key for use by the MinIO Server:</p>
<div class="copyable highlight-shell notranslate"><div class="highlight"><pre><span></span>kes<span class="w"> </span>identity<span class="w"> </span>new
</pre></div>
</div>
<p>The output includes both the API Key for use with MinIO and the Identity hash for use with the <a class="reference external" href="https://docs.min.io/community/minio-kes/tutorials/configuration/#policy-configuration">KES Policy configuration</a>.</p>
</li>
<li><p>Configure the MinIO Environment File</p>
<p>Create or modify the MinIO Server environment file for all hosts in the target deployment to include the following environment variables:</p>
<p>Add the following lines to the MinIO Environment file on each MinIO host.
See the tutorials for <a class="reference internal" href="../deployments/installation.html#minio-snsd"><span class="std std-ref">Installation and Management</span></a>, <a class="reference internal" href="../deployments/installation.html#minio-snmd"><span class="std std-ref">Installation and Management</span></a>, or <a class="reference internal" href="../deployments/installation.html#minio-mnmd"><span class="std std-ref">Installation and Management</span></a> for more detailed descriptions of a base MinIO environment file.</p>
<div class="copyable highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add these environment variables to the existing environment file</span>

<span class="nv">MINIO_KMS_KES_ENDPOINT</span><span class="o">=</span>https://HOSTNAME:7373
<span class="nv">MINIO_KMS_KES_API_KEY</span><span class="o">=</span><span class="s2">&quot;kes:v1:ACTpAsNoaGf2Ow9o5gU8OmcaG6Af/VcZ1Mt7ysuKoBjv&quot;</span>

<span class="c1"># Allows validation of the KES Server Certificate (Self-Signed or Third-Party CA)</span>
<span class="c1"># Change this path to the location of the KES CA Path</span>
<span class="nv">MINIO_KMS_KES_CAPATH</span><span class="o">=</span><span class="p">|</span>kescertpath<span class="p">|</span>/kes-server.cert

<span class="c1"># Sets the default KMS key for the backend and SSE-KMS/SSE-S3 Operations)</span>
<span class="nv">MINIO_KMS_KES_KEY_NAME</span><span class="o">=</span>minio-backend-default-key
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">HOSTNAME</span></code> with the IP address or hostname of the KES server.
If the MinIO server host machines cannot resolve or reach the specified <code class="docutils literal notranslate"><span class="pre">HOSTNAME</span></code>, the deployment may return errors or fail to start.</p>
<ul class="simple">
<li><p>If using a single KES server host, specify the IP or hostname of that host</p></li>
<li><p>If using multiple KES server hosts, specify a comma-separated list of IPs or hostnames of each host</p></li>
</ul>
<p>MinIO uses the <a class="reference internal" href="../../reference/minio-server/settings/kes.html#envvar.MINIO_KMS_KES_KEY_NAME" title="envvar.MINIO_KMS_KES_KEY_NAME"><code class="xref minio minio-envvar docutils literal notranslate"><span class="pre">MINIO_KMS_KES_KEY_NAME</span></code></a> key for the following cryptographic operations:</p>
<ul class="simple">
<li><p>Encrypting the MinIO backend (IAM, configuration, etc.)</p></li>
<li><p>Encrypting objects using <a class="reference internal" href="../../administration/server-side-encryption/server-side-encryption-sse-kms.html#minio-encryption-sse-kms"><span class="std std-ref">SSE-KMS</span></a> if the request does not include a specific <abbr title="External Key">EK</abbr>.</p></li>
<li><p>Encrypting objects using <a class="reference internal" href="../../administration/server-side-encryption/server-side-encryption-sse-s3.html#minio-encryption-sse-s3"><span class="std std-ref">SSE-S3</span></a>.</p></li>
</ul>
<p>MinIO defaults to expecting this file at <code class="docutils literal notranslate"><span class="pre">/etc/default/minio</span></code>.
If you modified your deployment to use a different location for the environment file, modify the file at that location.</p>
</li>
<li><p>Start MinIO</p>
<div class="important admonition">
<p class="admonition-title">KES Operations Requires Unsealed Vault</p>
<p>Depending on your selected KMS solution, you may need to unseal the key instance to allow normal cryptographic operations, including key creation or retrieval.
KES requires an unsealed key target to perform its operations.</p>
<p>Refer to the <a class="reference external" href="https://docs.min.io/community/minio-kes/#supported-kms-targets">documentation for your chosen KMS solution</a> for information regarding whether sealing and unsealing the instance is required for operations.</p>
<p>You must start KES <em>before</em> starting MinIO.
The MinIO deployment requires access to KES as part of its startup.</p>
</div>
<p>You can use the <a class="reference internal" href="../../reference/minio-mc-admin/mc-admin-service.html#mc.admin.service.restart" title="mc.admin.service.restart"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">mc</span> <span class="pre">admin</span> <span class="pre">service</span> <span class="pre">restart</span></code></a> command to restart MinIO:</p>
<div class="copyable highlight-shell notranslate"><div class="highlight"><pre><span></span>mc<span class="w"> </span>admin<span class="w"> </span>service<span class="w"> </span>restart<span class="w"> </span>ALIAS
</pre></div>
</div>
</li>
<li><p>Generate a New Encryption Key</p>
<p>MinIO requires that the <abbr title="External Key">EK</abbr> exist on the KMS <em>before</em> performing <abbr title="Server-Side Encryption">SSE</abbr> operations using that key.
Use <code class="docutils literal notranslate"><span class="pre">kes</span> <span class="pre">key</span> <span class="pre">create</span></code> <em>or</em> <a class="reference internal" href="../../reference/minio-mc-admin/mc-admin-kms-key.html#mc.admin.kms.key.create" title="mc.admin.kms.key.create"><code class="xref minio minio-mc-cmd docutils literal notranslate"><span class="pre">mc</span> <span class="pre">admin</span> <span class="pre">kms</span> <span class="pre">key</span> <span class="pre">create</span></code></a> to add a new <abbr title="External Key">EK</abbr> for use with <abbr title="Server-Side Encryption">SSE</abbr>.</p>
<p>The following command uses the <a class="reference internal" href="../../reference/minio-mc-admin/mc-admin-kms-key.html#mc.admin.kms.key.create" title="mc.admin.kms.key.create"><code class="xref minio minio-mc-cmd docutils literal notranslate"><span class="pre">mc</span> <span class="pre">admin</span> <span class="pre">kms</span> <span class="pre">key</span> <span class="pre">create</span></code></a> command to add a new External Key (EK) stored on the KMS server for use with encrypting the MinIO backend.</p>
<div class="copyable highlight-shell notranslate"><div class="highlight"><pre><span></span>mc<span class="w"> </span>admin<span class="w"> </span>kms<span class="w"> </span>key<span class="w"> </span>create<span class="w"> </span>ALIAS<span class="w"> </span>KEYNAME
</pre></div>
</div>
</li>
<li><p>Enable SSE-KMS for a Bucket</p>
<p>Use the MinIO <a class="reference internal" href="../../reference/minio-mc.html#command-mc" title="mc"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">mc</span></code></a> CLI to enable bucket-default SSE-KMS with the generated key:</p>
<p>The following commands:</p>
<ul class="simple">
<li><p>Create a new <a class="reference internal" href="../../reference/minio-mc/mc-alias-set.html#alias"><span class="std std-ref">alias</span></a> for the MinIO deployment</p></li>
<li><p>Create a new bucket for storing encrypted data</p></li>
<li><p>Enable SSE-KMS encryption on that bucket</p></li>
</ul>
<div class="copyable highlight-shell notranslate"><div class="highlight"><pre><span></span>mc<span class="w"> </span><span class="nb">alias</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nb">local</span><span class="w"> </span>http://127.0.0.1:9000<span class="w"> </span>ROOTUSER<span class="w"> </span>ROOTPASSWORD

mc<span class="w"> </span>mb<span class="w"> </span>local/encryptedbucket
mc<span class="w"> </span>encrypt<span class="w"> </span><span class="nb">set</span><span class="w"> </span>SSE-KMS<span class="w"> </span>encrypted-bucket-key<span class="w"> </span>ALIAS/encryptedbucket
</pre></div>
</div>
<p>Write a file to the bucket using <a class="reference internal" href="../../reference/minio-mc/mc-cp.html#command-mc.cp" title="mc.cp"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">mc</span> <span class="pre">cp</span></code></a> or any S3-compatible SDK with a <code class="docutils literal notranslate"><span class="pre">PutObject</span></code> function.
You can then run <a class="reference internal" href="../../reference/minio-mc/mc-stat.html#command-mc.stat" title="mc.stat"><code class="xref minio minio-mc docutils literal notranslate"><span class="pre">mc</span> <span class="pre">stat</span></code></a> on the file to confirm the associated encryption metadata.</p>
</li>
</ol>
</div>
</div>
</section>
</section>


            </div><div class="footer">
   This work is licensed under a
   <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License.</a>
   2020-Present, MinIO, Inc. 
   <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img height="10" alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/80x15.png" />
   </a>
</div>
         </div>
      </div>
   </section><div id="cookie">
    <div class="container">
        <div class="cookie__text">
            <strong>Your privacy is important to us:</strong>
            We use cookies in order to give you a better experience. If you wish so, you can always review our 
            <a target="_blank" rel="noreferrer noopener" href="https://min.io/privacy-policy">Privacy Policy</a>.
        </div>

        <button type="button" id="cookie__btn">Accept</button>
    </div>
</div><script>
    // Dark mode and read mode detection

    // Dark mode
    /*var isDarkMode = localStorage.getItem("dark-mode");
    var dmToggleBtn = document.getElementById("dark-mode-toggle");
    if (isDarkMode === "true") {
       document.documentElement.classList.add("dark-mode");
       dmToggleBtn.classList.add("active");
    }

    // Read mode
    var isReadMode = localStorage.getItem("read-mode");
    var rmToggleBtn = document.getElementById("read-mode-toggle");

    if (isReadMode === "true") {
        document.documentElement.classList.add("read-mode");
        rmToggleBtn.classList.add("active");
    }*/
 </script>
  </body>
</html>